# MULTI-PROFILE

## 1. Справочник связок (Persistent Task Links)

### Цель
Реализовать механизм постоянных связей между задачами, позволяющий автоматически дублировать или связывать логи в разных профилях. Это полезно, когда задача в одном профиле должна автоматически отражаться в другой (например, внутренняя задача и задача заказчика).

### Команды для работы со связками

- **Добавление связи:**  
  ```bash
  lit link add <source_task> <target_profile:target_task>
  ```
  *Пример:*  
  ```bash
  lit link add DEV-123 bk:BKS-789
  ```
  Это создаст связь, благодаря которой при логировании в профиле с задачей `DEV-123` автоматически будет создана дублирующая запись в профиле `bk` для задачи `BKS-789`.

- **Просмотр списка связей:**  
  ```bash
  lit link list
  ```
  *Ожидаемый вывод:*
  ```
  # ID | SOURCE      | TARGET
  # 1  | DEV-123     | bk:BKS-789
  ```

- **Удаление связи:**  
  ```bash
  lit link remove <link_id>
  ```
  *Пример:*  
  ```bash
  lit link remove 1
  ```

### Логика работы
- При создании лога система проверяет, существуют ли для указанной задачи связи. Если да, то в дополнение к стандартной записи в активном профиле, лог дублируется в соответствующий профиль с заменой номера задачи согласно справочнику.
- Связи могут быть реализованы как временные (линкинг) или постоянные (копирование) – это можно разграничить флагами, например:
  - `-l` (linked) – создаётся связь, которая привязывает логи между профилями.
  - `-c` (copy) – просто копирует запись в другой профиль без последующей синхронизации.


## 2. Структура каталогов

Предлагаемая структура для работы с профилями выглядит следующим образом:

```
~/.lit/
├── .litprofiles          # Общий конфигурационный файл профилей
├── profiles/
│   ├── zb/              # Базовый профиль (например, для внутренней работы)
│   │   ├── .litconfig   # Конфигурация для профиля zb (Jira, GitLab и пр.)
│   │   ├── .litstore    # Локальное хранилище логов для zb
│   │   └── ...          # Дополнительные файлы (кэш, справочники и т.д.)
│   └── bk/              # Профиль заказчика
│       ├── .litconfig   # Конфигурация для профиля bk (отдельный URL Jira и пр.)
│       └── ...          # Файлы для bk
```

Таким образом, каждый профиль имеет собственную изолированную среду: свои настройки подключения, локальный кэш, историю логов и справочники для автодополнения.



## 3. Управление профилями

### Варианты команд
Чтобы удобно создавать и переключаться между профилями, можно добавить следующие команды:

- **Создать новый профиль:**  
  ```bash
  lit profile create <name>
  ```
  Эта команда создаст новую директорию с базовой структурой, например, в `~/.lit/profiles/<name>`, и предложит пройти базовую настройку конфигурации (либо через интерактивный режим, либо с ключами).

- **Переключить активный профиль:**  
  ```bash
  lit profile switch <name>
  ```
  Команда устанавливает активный профиль, после чего все команды (например, `lit add`) будут работать в контексте выбранного профиля. Это позволит, например, переключиться на профиль заказчика и вводить задачи без префикса (просто указывая номер задачи, как обычно).

- **Просмотр всех профилей:**  
  ```bash
  lit profile list
  ```
  Отобразит список всех доступных профилей, например:
  ```
  # Available profiles:
  #  zb   (active)
  #  bk
  ```

- **Связь между профилями через профильную команду (опционально):**  
  ```bash
  lit profile link <jira_task>
  ```
  Эта команда может использоваться для привязки задачи из другого профиля, если хочется настроить связь непосредственно из контекста профиля. Однако её необходимость стоит обсудить, так как уже имеется отдельная команда `lit link add`.

### Обсуждение команд и сценариев использования

- **Переключение профиля (`switch`):**  
  Идея в том, чтобы пользователь мог работать в "чистом" контексте нужного профиля, не указывая каждый раз префикс. Например, переключившись на профиль заказчика, можно логировать задачи непосредственно для него.

- **Интеграция с `init`:**  
  Возможно, команда `lit init` может служить инициализацией нового профиля. Например, можно сделать алиас или опцию:
  ```bash
  lit init --profile <name>
  ```
  При этом если профиль не существует, система предложит создать новый профиль, что эквивалентно выполнению `lit profile create <name>`.

- **Управление профилями через отдельный файл `.litprofiles`:**  
  Все настройки, списки профилей и информация об активном профиле могут храниться в файле `~/.lit/.litprofiles`. Это позволит при запуске утилиты быстро определять, с каким профилем работать по умолчанию, а также выполнять автоматическое переключение при запуске определённых команд.



## 4. Итоговая концепция работы с мульти-профилем и связками

1. **Создание профилей:**  
   - Команда `lit profile create <name>` создаёт новую изолированную среду для логов.
   - Все профили сохраняются в каталоге `~/.lit/profiles/` и управляются через общий конфигурационный файл `~/.lit/.litprofiles`.

2. **Работа с логами:**  
   - Стандартная команда `lit add` работает в контексте активного профиля.
   - При наличии связей (через `lit link add`) лог автоматически дублируется или линкуется с задачами в других профилях.

3. **Переключение между профилями:**  
   - Команда `lit profile switch <name>` позволяет сменить активный профиль, что упрощает работу, если пользователь хочет работать напрямую с задачами другого профиля без указания префиксов.
   - Это особенно полезно, если нужно переключаться между внутренней Jira и Jira заказчика.

4. **Дополнительное управление:**  
   - Команды `lit profile list` и `lit link list` позволяют просматривать текущие настройки и связи, что делает работу более прозрачной.
   - Возможное объединение команды `init` с `profile create` позволяет задать начальные настройки нового профиля сразу при инициализации.

## 5. Примеры
```bash
# Обычный лог
lit add TASK-123 2h "..." 

# Лог в два профиля
lit add TASK-123 2h "..." -c bk:BKS-321
# ⚠️ Создана вторая запись для профиля bk с кодом BKS-321 
```

```bash
lit add DEV-123 1h "Фикс" -l temp:TMP-001
# ⚠️ Создана вторая запись для профиля temp с кодом TMP-001 

lit link list
# ID | SOURCE      | TARGET
# 1  | DEV-123     | temp:TMP-001

lit add DEV-123 1h "Фикс 2"
# ⚠️ Обнаружена связь! Создана вторая запись для профиля temp с кодом TMP-001
```

## 6. Multi-link *Сырая мысль*
Продумать механику прилинковки одной задачи ко всем задачам другого профиля.
Это полезно когда в одной Jira есть детализация, а в другой всё идёт в одну задачу. 

Пава вариантов
```bash
lit link list
# ID | SOURCE      | TARGET
# 1  | DEV-123     | temp:*
# 2  | *           | ZB:OUTSF-005
```